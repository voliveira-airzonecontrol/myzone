schema: '2.0'
stages:
  fetch_data:
    cmd: python -m src.data_injection.fetch_data --env prod
    deps:
    - path: src/data_injection/fetch_data.py
      hash: md5
      md5: 3a77c73df82e99c69c97d4047db96fde
      size: 2791
    outs:
    - path: raw_data/prod/articulos.csv
      hash: md5
      md5: 59171175ef48682b235c8c9ac7f36c51
      size: 8590891
    - path: raw_data/prod/estados.csv
      hash: md5
      md5: 2ff4c4cc55108bf413f8037ebcd63024
      size: 635
    - path: raw_data/prod/incidencias.csv
      hash: md5
      md5: 8a2b12fc3c94f2966898074e3e202497
      size: 9843543
    - path: raw_data/prod/incidencias_tipo.csv
      hash: md5
      md5: b026a6c3874000996c2fab945740cf03
      size: 177
    - path: raw_data/prod/piezas.csv
      hash: md5
      md5: 80f20a0b2cde00fa6fc7a9ed700e9c06
      size: 10847074
  translate_data:
    cmd: python -m src.preprocessing.translation --env prod --input-incidencias raw_data/prod/incidencias.csv
      --input-piezas raw_data/prod/piezas.csv --input-estados raw_data/prod/estados.csv
      --input-incidencias-tipo raw_data/prod/incidencias_tipo.csv --output-path output_data/prod
    deps:
    - path: raw_data/prod/estados.csv
      hash: md5
      md5: 2ff4c4cc55108bf413f8037ebcd63024
      size: 635
    - path: raw_data/prod/incidencias.csv
      hash: md5
      md5: 8a2b12fc3c94f2966898074e3e202497
      size: 9843543
    - path: raw_data/prod/incidencias_tipo.csv
      hash: md5
      md5: b026a6c3874000996c2fab945740cf03
      size: 177
    - path: raw_data/prod/piezas.csv
      hash: md5
      md5: 80f20a0b2cde00fa6fc7a9ed700e9c06
      size: 10847074
    - path: src/preprocessing/translation.py
      hash: md5
      md5: 91fef21391f2e44e84c17368af0961ae
      size: 7493
    outs:
    - path: output_data/prod/desc_problema_translated.csv
      hash: md5
      md5: fecc244aa0a412ff6171fa075fa36912
      size: 2001100
    - path: output_data/prod/descripcion_translated.csv
      hash: md5
      md5: 3532f012b420c2797df4244bd2d49cce
      size: 455820
    - path: output_data/prod/problema_translated.csv
      hash: md5
      md5: 4eae81fef9e56e1b7f6fb79ec3da79e0
      size: 1582089
  find_best_matches:
    cmd: python -m src.preprocessing.find_best_matches --env prod --input-piezas raw_data/prod/piezas.csv
      --input-articulos raw_data/prod/articulos.csv --output-best-matches output_data/prod/fuzzy_matches_w_scores.csv
    deps:
    - path: raw_data/prod/articulos.csv
      hash: md5
      md5: 59171175ef48682b235c8c9ac7f36c51
      size: 8590891
    - path: raw_data/prod/piezas.csv
      hash: md5
      md5: 80f20a0b2cde00fa6fc7a9ed700e9c06
      size: 10847074
    outs:
    - path: output_data/prod/fuzzy_matches_w_scores.csv
      hash: md5
      md5: f1fdae2796583a461269ccd6d0902537
      size: 2364608
  preprocessing:
    cmd: python -m src.preprocessing.preprocessing --env prod --translation-data-folder
      output_data/prod --raw-data-folder raw_data/prod --input-best-matches output_data/prod/fuzzy_matches_w_scores.csv
      --input-articulos raw_data/prod/articulos.csv --output-path output_data/prod/preprocessed_data.csv
    deps:
    - path: output_data/prod/desc_problema_translated.csv
      hash: md5
      md5: fecc244aa0a412ff6171fa075fa36912
      size: 2001100
    - path: output_data/prod/descripcion_translated.csv
      hash: md5
      md5: 3532f012b420c2797df4244bd2d49cce
      size: 455820
    - path: output_data/prod/fuzzy_matches_w_scores.csv
      hash: md5
      md5: f1fdae2796583a461269ccd6d0902537
      size: 2364608
    - path: output_data/prod/problema_translated.csv
      hash: md5
      md5: 4eae81fef9e56e1b7f6fb79ec3da79e0
      size: 1582089
    - path: raw_data/prod/articulos.csv
      hash: md5
      md5: 59171175ef48682b235c8c9ac7f36c51
      size: 8590891
    - path: raw_data/prod/estados.csv
      hash: md5
      md5: 2ff4c4cc55108bf413f8037ebcd63024
      size: 635
    - path: raw_data/prod/incidencias.csv
      hash: md5
      md5: 8a2b12fc3c94f2966898074e3e202497
      size: 9843543
    - path: raw_data/prod/incidencias_tipo.csv
      hash: md5
      md5: b026a6c3874000996c2fab945740cf03
      size: 177
    - path: raw_data/prod/piezas.csv
      hash: md5
      md5: 80f20a0b2cde00fa6fc7a9ed700e9c06
      size: 10847074
    - path: src/preprocessing/preprocessing.py
      hash: md5
      md5: da7380610822ceffdd2d814e468398a9
      size: 4035
    outs:
    - path: output_data/prod/preprocessed_data.csv
      hash: md5
      md5: eea7a168d068a845ed66908e337866bb
      size: 10855843
  generate_corpus:
    cmd: python -m src.preprocessing.generate_corpus --env prod --input-preprocessed-data
      output_data/prod/preprocessed_data.csv --input-documentation-path 
      \\central4\Publica\Product_technical_documentation-Documentación_técnica_producto
      --input-training-data-path "C:/Users/voliveira/OneDrive - Corporacion Empresarial
      Altra SL/00-Proyectos/Datos - Myzone/TrainningData" --output-corpus output_data/prod/corpus.csv
    deps:
    - path: output_data/prod/preprocessed_data.csv
      hash: md5
      md5: eea7a168d068a845ed66908e337866bb
      size: 10855843
    - path: src/preprocessing/generate_corpus.py
      hash: md5
      md5: 1daf1d56a6179f5943e4c3056a4a69d4
      size: 4922
    outs:
    - path: output_data/prod/corpus.csv
      hash: md5
      md5: 2bceb74a7cee8d0e1e12d8c833f2fb39
      size: 26543597
  tfidf_encoding:
    cmd: python -m src.encoding.tfidf_encoding --env prod --input-data output_data/prod/preprocessed_data.csv
      --output-tfidf-encoded-data output_data/prod/tfidf_encoded_data.csv --output-tfidf-model
      encode_models/prod/tfidf_model.joblib
    deps:
    - path: output_data/prod/preprocessed_data.csv
      hash: md5
      md5: eea7a168d068a845ed66908e337866bb
      size: 10855843
    - path: src/encoding/tfidf_encoding.py
      hash: md5
      md5: c44953ea76a7c5db2255b731c80f8989
      size: 5225
    outs:
    - path: output_data/prod/tfidf_encoded_data.csv
      hash: md5
      md5: c988cfc43fa31a9b2abac65209003922
      size: 3580827
  doc2vec_encoding:
    cmd: python -m src.encoding.doc2vec_encoding --env prod --input-data output_data/prod/preprocessed_data.csv
      --input-corpus output_data/prod/corpus.csv --output-doc2vec-encoded-data output_data/prod/doc2vec_encoded_data.csv
      --output-doc2vec-model encode_models/prod/doc2vec_model.joblib
    deps:
    - path: output_data/prod/corpus.csv
      hash: md5
      md5: 2bceb74a7cee8d0e1e12d8c833f2fb39
      size: 26543597
    - path: src/encoding/doc2vec_encoding.py
      hash: md5
      md5: 56bdd051a85c5aac4193576bde2b3e18
      size: 6525
    outs:
    - path: output_data/prod/doc2vec_encoded_data.csv
      hash: md5
      md5: 2217a55831dc17697a2cdf50f486b7bd
      size: 728873267
  sentence_transformer_encoding:
    cmd: python -m src.encoding.sentence_transformer_encoding --env prod --input-data
      output_data/prod/preprocessed_data.csv --output-sentence-transformer-encoded-data
      output_data/prod/sentence_transformer_encoded_data.csv
    deps:
    - path: output_data/prod/preprocessed_data.csv
      hash: md5
      md5: eea7a168d068a845ed66908e337866bb
      size: 10855843
    - path: src/encoding/sentence_transformer_encoding.py
      hash: md5
      md5: ca7050859a7b2ac48dec0e9a8df29093
      size: 4994
    outs:
    - path: output_data/prod/sentence_transformer_encoded_data.csv
      hash: md5
      md5: 79a83887fbe9a56e217a4c5998a9e55f
      size: 314597868
  generate_unsupervised_dataset:
    cmd: python -m src.encoding.generate_unsupervised_dataset --env prod --input-tfidf-encoded-data
      output_data/prod/tfidf_encoded_data.csv --input-doc2vec-encoded-data output_data/prod/doc2vec_encoded_data.csv
      --input-sentence-transformer-encoded-data output_data/prod/sentence_transformer_encoded_data.csv
      --input-preprocessed-data output_data/prod/preprocessed_data.csv --output-unsupervised-tfidf-dataset
      output_data/prod/unsupervised_tfidf_dataset.csv --output-unsupervised-doc2vec-dataset
      output_data/prod/unsupervised_doc2vec_dataset.csv --output-unsupervised-sentence-transformer-dataset
      output_data/prod/unsupervised_sentence_transformer_dataset.csv --input-tfidf-model
      encode_models/prod/tfidf_model.joblib --input-doc2vec-model encode_models/prod/doc2vec_model.joblib
      --input-tipo-error raw_data/prod/TablaTipoErrorPostventa.csv
    deps:
    - path: encode_models/prod/doc2vec_model.joblib
      hash: md5
      md5: a1d7838376b13051c75c45d358aff88f
      size: 192598078
    - path: encode_models/prod/tfidf_model.joblib
      hash: md5
      md5: 0dc5847f4b679f53170f7875b45a7e56
      size: 1523
    - path: output_data/prod/doc2vec_encoded_data.csv
      hash: md5
      md5: 2217a55831dc17697a2cdf50f486b7bd
      size: 728873267
    - path: output_data/prod/preprocessed_data.csv
      hash: md5
      md5: eea7a168d068a845ed66908e337866bb
      size: 10855843
    - path: output_data/prod/sentence_transformer_encoded_data.csv
      hash: md5
      md5: 79a83887fbe9a56e217a4c5998a9e55f
      size: 314597868
    - path: output_data/prod/tfidf_encoded_data.csv
      hash: md5
      md5: c988cfc43fa31a9b2abac65209003922
      size: 3580827
    - path: raw_data/prod/TablaTipoErrorPostventa.csv
      hash: md5
      md5: 126e9dc31f5fa16a534e2edd71a12914
      size: 8640
    - path: src/encoding/generate_unsupervised_dataset.py
      hash: md5
      md5: 148759d08a997ee8cd38f29630a76d32
      size: 9932
    outs:
    - path: output_data/prod/unsupervised_doc2vec_dataset.csv
      hash: md5
      md5: f493f1422574eae9776cac64c15d212c
      size: 778046319
    - path: output_data/prod/unsupervised_sentence_transformer_dataset.csv
      hash: md5
      md5: 85de02ce877d7fa6249d0d35a8a398c6
      size: 320214493
    - path: output_data/prod/unsupervised_tfidf_dataset.csv
      hash: md5
      md5: 8b34df10f1d96f4ef0be17896d7d8d09
      size: 18849173
  generate_supervised_dataset:
    cmd: python -m src.encoding.generate_supervised_dataset --env prod --input-reviewed-data
      raw_data/prod/reviewed_dataset.csv --output-supervised-dataset output_data/prod/supervised_dataset.parquet
      --output-supervised-dataset-phase2 output_data/prod/supervised_dataset_phase2.parquet
    deps:
    - path: output_data/prod/unsupervised_sentence_transformer_dataset.csv
      hash: md5
      md5: 85de02ce877d7fa6249d0d35a8a398c6
      size: 320214493
    - path: raw_data/prod/reviewed_dataset.parquet
      hash: md5
      md5: 1bbe10a58360f476bc08997eefa749ce
      size: 150381349
    - path: src/encoding/generate_supervised_dataset.py
      hash: md5
      md5: f414190518753f82dfc8cab992196ccb
      size: 3192
    outs:
    - path: output_data/prod/supervised_dataset.parquet
      hash: md5
      md5: d9e0799637e035083cd613ff9e8e5ab9
      size: 193359
  training:
    cmd: python -m src.training.training --env prod --input-dataset output_data/prod/supervised_dataset.parquet
      --output-model output_models/prod/trained_model
    deps:
    - path: output_data/prod/supervised_dataset.parquet
      hash: md5
      md5: d9e0799637e035083cd613ff9e8e5ab9
      size: 193359
    - path: src/training/training.py
      hash: md5
      md5: f68e09c8b38ac0bda0e09e793757515d
      size: 3868
    outs:
    - path: output_models/prod/trained_model
      hash: md5
      md5: 07a0b3f87a408cb91e1b7ae57fe7cb44.dir
      size: 440407610
      nfiles: 6
  evaluate_model:
    cmd: python -m src.evaluating.evaluate --env prod --input-dataset output_data/prod/supervised_dataset.parquet
      --input-model output_models/prod/trained_model --output-reports output_reports/prod
    deps:
    - path: output_data/prod/supervised_dataset.parquet
      hash: md5
      md5: d9e0799637e035083cd613ff9e8e5ab9
      size: 193359
    - path: output_models/prod/trained_model
      hash: md5
      md5: 07a0b3f87a408cb91e1b7ae57fe7cb44.dir
      size: 440407610
      nfiles: 6
    - path: src/evaluating/evaluate.py
      hash: md5
      md5: 751bedf3d80425bc54c0fd51ef0089aa
      size: 5348
    outs:
    - path: output_reports/prod/classification_report.txt
      hash: md5
      md5: f5acd2a1b196bd30725b86196756f338
      size: 463
    - path: output_reports/prod/confusion_matrix.png
      hash: md5
      md5: 2db3965967f86a3014380bb45fc91ce6
      size: 17122
    - path: output_reports/prod/roc_curve.png
      hash: md5
      md5: 11ff01002e414e63339c643082764962
      size: 27720
  detect_outliers:
    cmd: python -m src.conformal_prediction.outlier_detection --env prod --input-dataset
      output_data/prod/supervised_dataset.parquet --input-model output_models/prod/trained_model
      --input-outliers output_data/prod/supervised_dataset_phase2.parquet --output-reports
      output_reports/prod/outlier_detection
    deps:
    - path: output_data/prod/supervised_dataset.parquet
      hash: md5
      md5: d9e0799637e035083cd613ff9e8e5ab9
      size: 193359
    - path: output_data/prod/supervised_dataset_phase2.parquet
      hash: md5
      md5: a3a90925a89b78d72d72f7aca17f794b
      size: 59178
    - path: output_models/prod/trained_model
      hash: md5
      md5: 07a0b3f87a408cb91e1b7ae57fe7cb44.dir
      size: 440407610
      nfiles: 6
    - path: src/conformal_prediction/outlier_detection.py
      hash: md5
      md5: f739d30418c8d1398d2ddab832b4ada3
      size: 10813
    outs:
    - path: output_reports/prod/outlier_detection/conformal_set_size_distribution.png
      hash: md5
      md5: 04142f92938f9f30ec8f01d099f844ee
      size: 15371
    - path: output_reports/prod/outlier_detection/detected_outliers.parquet
      hash: md5
      md5: 453a875f51a9507c751f2fc9426f6284
      size: 7503
    - path: output_reports/prod/outlier_detection/outlier_detection_confusion_matrix.png
      hash: md5
      md5: 0ad3ead6202cdd1f7880e16c5982d6c0
      size: 21561
    - path: output_reports/prod/outlier_detection/outlier_evaluation_report.txt
      hash: md5
      md5: 62af545eae23406f7327c48fac75821d
      size: 550
    - path: output_reports/prod/outlier_detection/outliers_by_class.png
      hash: md5
      md5: ed30e3de4de0a44b879c053a01b1c839
      size: 15293
  clustering:
    cmd: python -m src.clustering.clustering --env prod --input-dataset output_data/prod/supervised_dataset.parquet
      --input-outliers output_reports/prod/outlier_detection/detected_outliers.parquet
      --input-model output_models/prod/trained_model --output-new-class output_reports/prod/clustering/new_class.parquet
      --output-reports output_reports/prod/clustering
    deps:
    - path: output_data/prod/supervised_dataset.parquet
      hash: md5
      md5: d9e0799637e035083cd613ff9e8e5ab9
      size: 193359
    - path: output_models/prod/trained_model
      hash: md5
      md5: 07a0b3f87a408cb91e1b7ae57fe7cb44.dir
      size: 440407610
      nfiles: 6
    - path: output_reports/prod/outlier_detection/detected_outliers.parquet
      hash: md5
      md5: 453a875f51a9507c751f2fc9426f6284
      size: 7503
    - path: src/clustering/clustering.py
      hash: md5
      md5: f3e46d784a694d67ba02880343bac2ee
      size: 8018
    outs:
    - path: output_reports/prod/clustering/cluster_sizes.png
      hash: md5
      md5: 8e5d86789901ab51a80fc6d895ec4cf7
      size: 21293
    - path: output_reports/prod/clustering/cluster_summary.csv
      hash: md5
      md5: 1ec9c38ff34967b19bacdcbbd79094bb
      size: 37509
    - path: output_reports/prod/clustering/cluster_visualization.png
      hash: md5
      md5: dde6147534a12516a52184534869da97
      size: 56597
    - path: output_reports/prod/clustering/distance_heatmap.png
      hash: md5
      md5: 81ee291d89b0a4b2d3e4b1da08653204
      size: 38521
    - path: output_reports/prod/clustering/distance_to_centroids.csv
      hash: md5
      md5: ceaf0ae4fbf591d5721c35f0639cbdeb
      size: 1303
    - path: output_reports/prod/clustering/new_class.parquet
      hash: md5
      md5: 7f59fc043cf867fe1366fb6b9b3353e5
      size: 391101
    - path: output_reports/prod/clustering/silhouette_analysis.png
      hash: md5
      md5: c5b714645cdb61abf0976307c5802afe
      size: 41102
  incremental_training:
    cmd: python -m src.incremental_training.incremental_training --env prod --input-dataset
      output_data/prod/supervised_dataset.parquet --input-new-class output_reports/prod/clustering/new_class.parquet
      --input-true-new-class output_data/prod/supervised_dataset_phase2.parquet --input-model
      output_models/prod/trained_model --output-model output_models/prod/incremented_model
    deps:
    - path: output_data/prod/supervised_dataset.parquet
      hash: md5
      md5: d9e0799637e035083cd613ff9e8e5ab9
      size: 193359
    - path: output_data/prod/supervised_dataset_phase2.parquet
      hash: md5
      md5: a3a90925a89b78d72d72f7aca17f794b
      size: 59178
    - path: output_models/prod/trained_model
      hash: md5
      md5: 07a0b3f87a408cb91e1b7ae57fe7cb44.dir
      size: 440407610
      nfiles: 6
    - path: output_reports/prod/clustering/new_class.parquet
      hash: md5
      md5: 3b0db27aa5ad108394590f787a665bc8
      size: 391101
    - path: src/incremental_training/incremental_training.py
      hash: md5
      md5: ee792f5a9f960d36bd20d353e0237860
      size: 6713
    outs:
    - path: output_models/prod/incremented_model
      hash: md5
      md5: 410d362ce71b6dee389c1b64a687dfe4.dir
      size: 440410910
      nfiles: 6
  evaluate_incremental_model:
    cmd: python -m src.evaluating.evaluate_incremental_model --env prod --input-dataset
      output_data/prod/supervised_dataset.parquet --input-new-class output_reports/prod/clustering/new_class.parquet
      --input-true-new-class output_data/prod/supervised_dataset_phase2.parquet --input-model
      output_models/prod/incremented_model --output-reports output_reports/prod/incremental
    deps:
    - path: output_data/prod/supervised_dataset.parquet
      hash: md5
      md5: d9e0799637e035083cd613ff9e8e5ab9
      size: 193359
    - path: output_data/prod/supervised_dataset_phase2.parquet
      hash: md5
      md5: a3a90925a89b78d72d72f7aca17f794b
      size: 59178
    - path: output_models/prod/incremented_model
      hash: md5
      md5: 410d362ce71b6dee389c1b64a687dfe4.dir
      size: 440410910
      nfiles: 6
    - path: output_reports/prod/clustering/new_class.parquet
      hash: md5
      md5: 3b0db27aa5ad108394590f787a665bc8
      size: 391101
    - path: src/evaluating/evaluate_incremental_model.py
      hash: md5
      md5: f13f1de5347ee7ae44bee49f6a90a05a
      size: 10399
    outs:
    - path: output_reports/prod/incremental/incremental_classification_report.txt
      hash: md5
      md5: 7b8a3e6689d1f7b69832a9d3c54ca0ee
      size: 518
    - path: output_reports/prod/incremental/incremental_confusion_matrix.png
      hash: md5
      md5: 82cef4a0cb4322a6e0165420a25f9897
      size: 20498
    - path: output_reports/prod/incremental/incremental_roc_curve.png
      hash: md5
      md5: 9ab1734f2f86de3af075be7bc56f5898
      size: 54266
