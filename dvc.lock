schema: '2.0'
stages:
  fetch_data:
    cmd: python -m src.data_injection.fetch_data --env prod
    deps:
    - path: src/data_injection/fetch_data.py
      hash: md5
      md5: 3a77c73df82e99c69c97d4047db96fde
      size: 2791
    outs:
    - path: raw_data/prod/articulos.csv
      hash: md5
      md5: 59171175ef48682b235c8c9ac7f36c51
      size: 8590891
    - path: raw_data/prod/estados.csv
      hash: md5
      md5: 2ff4c4cc55108bf413f8037ebcd63024
      size: 635
    - path: raw_data/prod/incidencias.csv
      hash: md5
      md5: 8a2b12fc3c94f2966898074e3e202497
      size: 9843543
    - path: raw_data/prod/incidencias_tipo.csv
      hash: md5
      md5: b026a6c3874000996c2fab945740cf03
      size: 177
    - path: raw_data/prod/piezas.csv
      hash: md5
      md5: 80f20a0b2cde00fa6fc7a9ed700e9c06
      size: 10847074
  translate_data:
    cmd: python -m src.preprocessing.translation --env prod --input-incidencias raw_data/prod/incidencias.csv
      --input-piezas raw_data/prod/piezas.csv --input-estados raw_data/prod/estados.csv
      --input-incidencias-tipo raw_data/prod/incidencias_tipo.csv --output-path output_data/prod
    deps:
    - path: raw_data/prod/estados.csv
      hash: md5
      md5: 2ff4c4cc55108bf413f8037ebcd63024
      size: 635
    - path: raw_data/prod/incidencias.csv
      hash: md5
      md5: 8a2b12fc3c94f2966898074e3e202497
      size: 9843543
    - path: raw_data/prod/incidencias_tipo.csv
      hash: md5
      md5: b026a6c3874000996c2fab945740cf03
      size: 177
    - path: raw_data/prod/piezas.csv
      hash: md5
      md5: 80f20a0b2cde00fa6fc7a9ed700e9c06
      size: 10847074
    - path: src/preprocessing/translation.py
      hash: md5
      md5: 91fef21391f2e44e84c17368af0961ae
      size: 7493
    outs:
    - path: output_data/prod/desc_problema_translated.csv
      hash: md5
      md5: fecc244aa0a412ff6171fa075fa36912
      size: 2001100
    - path: output_data/prod/descripcion_translated.csv
      hash: md5
      md5: 3532f012b420c2797df4244bd2d49cce
      size: 455820
    - path: output_data/prod/problema_translated.csv
      hash: md5
      md5: 4eae81fef9e56e1b7f6fb79ec3da79e0
      size: 1582089
  find_best_matches:
    cmd: python -m src.preprocessing.find_best_matches --env prod --input-piezas raw_data/prod/piezas.csv
      --input-articulos raw_data/prod/articulos.csv --output-best-matches output_data/prod/fuzzy_matches_w_scores.csv
    deps:
    - path: raw_data/prod/articulos.csv
      hash: md5
      md5: 59171175ef48682b235c8c9ac7f36c51
      size: 8590891
    - path: raw_data/prod/piezas.csv
      hash: md5
      md5: 80f20a0b2cde00fa6fc7a9ed700e9c06
      size: 10847074
    outs:
    - path: output_data/prod/fuzzy_matches_w_scores.csv
      hash: md5
      md5: f1fdae2796583a461269ccd6d0902537
      size: 2364608
  preprocessing:
    cmd: python -m src.preprocessing.preprocessing --env prod --translation-data-folder
      output_data/prod --raw-data-folder raw_data/prod --input-best-matches output_data/prod/fuzzy_matches_w_scores.csv
      --input-articulos raw_data/prod/articulos.csv --output-path output_data/prod/preprocessed_data.csv
    deps:
    - path: output_data/prod/desc_problema_translated.csv
      hash: md5
      md5: fecc244aa0a412ff6171fa075fa36912
      size: 2001100
    - path: output_data/prod/descripcion_translated.csv
      hash: md5
      md5: 3532f012b420c2797df4244bd2d49cce
      size: 455820
    - path: output_data/prod/fuzzy_matches_w_scores.csv
      hash: md5
      md5: f1fdae2796583a461269ccd6d0902537
      size: 2364608
    - path: output_data/prod/problema_translated.csv
      hash: md5
      md5: 4eae81fef9e56e1b7f6fb79ec3da79e0
      size: 1582089
    - path: raw_data/prod/articulos.csv
      hash: md5
      md5: 59171175ef48682b235c8c9ac7f36c51
      size: 8590891
    - path: raw_data/prod/estados.csv
      hash: md5
      md5: 2ff4c4cc55108bf413f8037ebcd63024
      size: 635
    - path: raw_data/prod/incidencias.csv
      hash: md5
      md5: 8a2b12fc3c94f2966898074e3e202497
      size: 9843543
    - path: raw_data/prod/incidencias_tipo.csv
      hash: md5
      md5: b026a6c3874000996c2fab945740cf03
      size: 177
    - path: raw_data/prod/piezas.csv
      hash: md5
      md5: 80f20a0b2cde00fa6fc7a9ed700e9c06
      size: 10847074
    - path: src/preprocessing/preprocessing.py
      hash: md5
      md5: da7380610822ceffdd2d814e468398a9
      size: 4035
    outs:
    - path: output_data/prod/preprocessed_data.csv
      hash: md5
      md5: eea7a168d068a845ed66908e337866bb
      size: 10855843
  generate_corpus:
    cmd: python -m src.preprocessing.generate_corpus --env prod --input-preprocessed-data
      output_data/prod/preprocessed_data.csv --input-documentation-path 
      \\central4\Publica\Product_technical_documentation-Documentación_técnica_producto
      --input-training-data-path "C:/Users/voliveira/OneDrive - Corporacion Empresarial
      Altra SL/00-Proyectos/Datos - Myzone/TrainningData" --output-corpus output_data/prod/corpus.csv
    deps:
    - path: output_data/prod/preprocessed_data.csv
      hash: md5
      md5: eea7a168d068a845ed66908e337866bb
      size: 10855843
    - path: src/preprocessing/generate_corpus.py
      hash: md5
      md5: 1daf1d56a6179f5943e4c3056a4a69d4
      size: 4922
    outs:
    - path: output_data/prod/corpus.csv
      hash: md5
      md5: 2bceb74a7cee8d0e1e12d8c833f2fb39
      size: 26543597
  tfidf_encoding:
    cmd: python -m src.encoding.tfidf_encoding --env prod --input-data output_data/prod/preprocessed_data.csv
      --output-tfidf-encoded-data output_data/prod/tfidf_encoded_data.csv --output-tfidf-model
      encode_models/prod/tfidf_model.joblib
    deps:
    - path: output_data/prod/preprocessed_data.csv
      hash: md5
      md5: eea7a168d068a845ed66908e337866bb
      size: 10855843
    - path: src/encoding/tfidf_encoding.py
      hash: md5
      md5: c44953ea76a7c5db2255b731c80f8989
      size: 5225
    outs:
    - path: output_data/prod/tfidf_encoded_data.csv
      hash: md5
      md5: c988cfc43fa31a9b2abac65209003922
      size: 3580827
  doc2vec_encoding:
    cmd: python -m src.encoding.doc2vec_encoding --env prod --input-data output_data/prod/preprocessed_data.csv
      --input-corpus output_data/prod/corpus.csv --output-doc2vec-encoded-data output_data/prod/doc2vec_encoded_data.csv
      --output-doc2vec-model encode_models/prod/doc2vec_model.joblib
    deps:
    - path: output_data/prod/corpus.csv
      hash: md5
      md5: 2bceb74a7cee8d0e1e12d8c833f2fb39
      size: 26543597
    - path: src/encoding/doc2vec_encoding.py
      hash: md5
      md5: 56bdd051a85c5aac4193576bde2b3e18
      size: 6525
    outs:
    - path: output_data/prod/doc2vec_encoded_data.csv
      hash: md5
      md5: 2217a55831dc17697a2cdf50f486b7bd
      size: 728873267
  sentence_transformer_encoding:
    cmd: python -m src.encoding.sentence_transformer_encoding --env prod --input-data
      output_data/prod/preprocessed_data.csv --output-sentence-transformer-encoded-data
      output_data/prod/sentence_transformer_encoded_data.csv
    deps:
    - path: output_data/prod/preprocessed_data.csv
      hash: md5
      md5: eea7a168d068a845ed66908e337866bb
      size: 10855843
    - path: src/encoding/sentence_transformer_encoding.py
      hash: md5
      md5: ca7050859a7b2ac48dec0e9a8df29093
      size: 4994
    outs:
    - path: output_data/prod/sentence_transformer_encoded_data.csv
      hash: md5
      md5: 79a83887fbe9a56e217a4c5998a9e55f
      size: 314597868
  generate_unsupervised_dataset:
    cmd: python -m src.encoding.generate_unsupervised_dataset --env prod --input-tfidf-encoded-data
      output_data/prod/tfidf_encoded_data.csv --input-doc2vec-encoded-data output_data/prod/doc2vec_encoded_data.csv
      --input-sentence-transformer-encoded-data output_data/prod/sentence_transformer_encoded_data.csv
      --input-preprocessed-data output_data/prod/preprocessed_data.csv --output-unsupervised-tfidf-dataset
      output_data/prod/unsupervised_tfidf_dataset.csv --output-unsupervised-doc2vec-dataset
      output_data/prod/unsupervised_doc2vec_dataset.csv --output-unsupervised-sentence-transformer-dataset
      output_data/prod/unsupervised_sentence_transformer_dataset.csv --input-tfidf-model
      encode_models/prod/tfidf_model.joblib --input-doc2vec-model encode_models/prod/doc2vec_model.joblib
      --input-tipo-error raw_data/prod/TablaTipoErrorPostventa.csv
    deps:
    - path: encode_models/prod/doc2vec_model.joblib
      hash: md5
      md5: a1d7838376b13051c75c45d358aff88f
      size: 192598078
    - path: encode_models/prod/tfidf_model.joblib
      hash: md5
      md5: 0dc5847f4b679f53170f7875b45a7e56
      size: 1523
    - path: output_data/prod/doc2vec_encoded_data.csv
      hash: md5
      md5: 2217a55831dc17697a2cdf50f486b7bd
      size: 728873267
    - path: output_data/prod/preprocessed_data.csv
      hash: md5
      md5: eea7a168d068a845ed66908e337866bb
      size: 10855843
    - path: output_data/prod/sentence_transformer_encoded_data.csv
      hash: md5
      md5: 79a83887fbe9a56e217a4c5998a9e55f
      size: 314597868
    - path: output_data/prod/tfidf_encoded_data.csv
      hash: md5
      md5: c988cfc43fa31a9b2abac65209003922
      size: 3580827
    - path: raw_data/prod/TablaTipoErrorPostventa.csv
      hash: md5
      md5: 126e9dc31f5fa16a534e2edd71a12914
      size: 8640
    - path: src/encoding/generate_unsupervised_dataset.py
      hash: md5
      md5: 148759d08a997ee8cd38f29630a76d32
      size: 9932
    outs:
    - path: output_data/prod/unsupervised_doc2vec_dataset.csv
      hash: md5
      md5: f493f1422574eae9776cac64c15d212c
      size: 778046319
    - path: output_data/prod/unsupervised_sentence_transformer_dataset.csv
      hash: md5
      md5: 85de02ce877d7fa6249d0d35a8a398c6
      size: 320214493
    - path: output_data/prod/unsupervised_tfidf_dataset.csv
      hash: md5
      md5: 8b34df10f1d96f4ef0be17896d7d8d09
      size: 18849173
  generate_supervised_dataset:
    cmd: python -m src.encoding.generate_supervised_dataset --env prod --input-reviewed-data
      raw_data/prod/reviewed_dataset.csv --output-supervised-dataset output_data/prod/supervised_dataset.parquet
      --output-supervised-dataset-phase2 output_data/prod/supervised_dataset_phase2.parquet
    deps:
    - path: output_data/prod/unsupervised_sentence_transformer_dataset.csv
      hash: md5
      md5: 85de02ce877d7fa6249d0d35a8a398c6
      size: 320214493
    - path: raw_data/prod/reviewed_dataset.parquet
      hash: md5
      md5: 1bbe10a58360f476bc08997eefa749ce
      size: 150381349
    - path: src/encoding/generate_supervised_dataset.py
      hash: md5
      md5: f414190518753f82dfc8cab992196ccb
      size: 3192
    outs:
    - path: output_data/prod/supervised_dataset.parquet
      hash: md5
      md5: d9e0799637e035083cd613ff9e8e5ab9
      size: 193359
  training:
    cmd: python -m src.training.training --env prod --input-dataset output_data/prod/supervised_dataset.parquet
      --output-model output_models/prod/trained_model
    deps:
    - path: output_data/prod/supervised_dataset.parquet
      hash: md5
      md5: d9e0799637e035083cd613ff9e8e5ab9
      size: 193359
    - path: src/training/training.py
      hash: md5
      md5: 4579c0ae26ae1b0d6abca1a1a4610a87
      size: 3922
    outs:
    - path: output_models/prod/trained_model
      hash: md5
      md5: 8b2a903c170d8354ecbf620702f098c6.dir
      size: 440407610
      nfiles: 6
  evaluate_model:
    cmd: python -m src.evaluating.evaluate --env prod --input-dataset output_data/prod/supervised_dataset.parquet
      --input-model output_models/prod/trained_model --output-reports output_reports/prod
    deps:
    - path: output_data/prod/supervised_dataset.parquet
      hash: md5
      md5: d9e0799637e035083cd613ff9e8e5ab9
      size: 193359
    - path: output_models/prod/trained_model
      hash: md5
      md5: 8b2a903c170d8354ecbf620702f098c6.dir
      size: 440407610
      nfiles: 6
    - path: src/evaluating/evaluate.py
      hash: md5
      md5: 751bedf3d80425bc54c0fd51ef0089aa
      size: 5348
    outs:
    - path: output_reports/prod/classification_report.txt
      hash: md5
      md5: e8f4cd62c69ad2325d33bc793260ea6c
      size: 462
    - path: output_reports/prod/confusion_matrix.png
      hash: md5
      md5: 56804def0edde2da51772ccadb59465e
      size: 16665
    - path: output_reports/prod/roc_curve.png
      hash: md5
      md5: e9618bb0a0c48d074d4651eb5abb2f1c
      size: 28236
  detect_outliers:
    cmd: python -m src.conformal_prediction.outlier_detection --env prod --input-dataset
      output_data/prod/supervised_dataset.parquet --input-model output_models/prod/trained_model
      --input-outliers output_data/prod/supervised_dataset_phase2.parquet --output-reports
      output_reports/prod/outlier_detection
    deps:
    - path: output_data/prod/supervised_dataset.parquet
      hash: md5
      md5: d9e0799637e035083cd613ff9e8e5ab9
      size: 193359
    - path: output_data/prod/supervised_dataset_phase2.parquet
      hash: md5
      md5: a3a90925a89b78d72d72f7aca17f794b
      size: 59178
    - path: output_models/prod/trained_model
      hash: md5
      md5: 8b2a903c170d8354ecbf620702f098c6.dir
      size: 440407610
      nfiles: 6
    - path: src/conformal_prediction/outlier_detection.py
      hash: md5
      md5: f739d30418c8d1398d2ddab832b4ada3
      size: 10813
    outs:
    - path: output_reports/prod/outlier_detection/conformal_set_size_distribution.png
      hash: md5
      md5: 8130b328f03ee220e99c4fba2ab5d2ad
      size: 15644
    - path: output_reports/prod/outlier_detection/detected_outliers.parquet
      hash: md5
      md5: 5e64aec706d773414e33734805f964d7
      size: 13225
    - path: output_reports/prod/outlier_detection/outlier_detection_confusion_matrix.png
      hash: md5
      md5: 752e66ee507064e9cfb1bf566b1d6694
      size: 21223
    - path: output_reports/prod/outlier_detection/outlier_evaluation_report.txt
      hash: md5
      md5: 8c29397bc1d76a5457aa0e564d6bea2f
      size: 550
    - path: output_reports/prod/outlier_detection/outliers_by_class.png
      hash: md5
      md5: 5e8cd2dd8ccd4506e9a81de2493e14c7
      size: 14983
  clustering:
    cmd: python -m src.clustering.clustering --env prod --input-dataset output_data/prod/supervised_dataset.parquet
      --input-outliers output_reports/prod/outlier_detection/detected_outliers.parquet
      --input-model output_models/prod/trained_model --output-new-class output_reports/prod/clustering/new_class.parquet
      --output-reports output_reports/prod/clustering
    deps:
    - path: output_data/prod/supervised_dataset.parquet
      hash: md5
      md5: d9e0799637e035083cd613ff9e8e5ab9
      size: 193359
    - path: output_models/prod/trained_model
      hash: md5
      md5: 8b2a903c170d8354ecbf620702f098c6.dir
      size: 440407610
      nfiles: 6
    - path: output_reports/prod/outlier_detection/detected_outliers.parquet
      hash: md5
      md5: 5e64aec706d773414e33734805f964d7
      size: 13225
    - path: src/clustering/clustering.py
      hash: md5
      md5: b9617a232b2b30fb6c5db6ed39500502
      size: 8291
    outs:
    - path: output_reports/prod/clustering/cluster_sizes.png
      hash: md5
      md5: 7084ad71f498b3dcae9a6207cace9ffa
      size: 20804
    - path: output_reports/prod/clustering/cluster_summary.csv
      hash: md5
      md5: 7e59edb70440fa2faf9387c6a8075afe
      size: 37507
    - path: output_reports/prod/clustering/cluster_visualization.png
      hash: md5
      md5: a9edcebe62b38b9ac493e99ffa4cea4a
      size: 68965
    - path: output_reports/prod/clustering/distance_heatmap.png
      hash: md5
      md5: b11162f04961aaf26a9a522a4e236cc0
      size: 35736
    - path: output_reports/prod/clustering/distance_to_centroids.csv
      hash: md5
      md5: 74c41b9f675c3d29132565513696bab7
      size: 1794
    - path: output_reports/prod/clustering/new_class.parquet
      hash: md5
      md5: 75e55f832a3a359155126e35c4735cc5
      size: 585181
    - path: output_reports/prod/clustering/silhouette_analysis.png
      hash: md5
      md5: f796a291669651078d0e24b744cb76f8
      size: 43217
  incremental_training:
    cmd: python -m src.incremental_training.incremental_training --env prod --input-dataset
      output_data/prod/supervised_dataset.parquet --input-new-class output_reports/prod/clustering/new_class.parquet
      --input-true-new-class output_data/prod/supervised_dataset_phase2.parquet --input-model
      output_models/prod/trained_model --output-model output_models/prod/incremented_model
    deps:
    - path: output_data/prod/supervised_dataset.parquet
      hash: md5
      md5: d9e0799637e035083cd613ff9e8e5ab9
      size: 193359
    - path: output_data/prod/supervised_dataset_phase2.parquet
      hash: md5
      md5: a3a90925a89b78d72d72f7aca17f794b
      size: 59178
    - path: output_models/prod/trained_model
      hash: md5
      md5: 8b2a903c170d8354ecbf620702f098c6.dir
      size: 440407610
      nfiles: 6
    - path: output_reports/prod/clustering/new_class.parquet
      hash: md5
      md5: 75e55f832a3a359155126e35c4735cc5
      size: 585181
    - path: src/incremental_training/incremental_training.py
      hash: md5
      md5: d2c787501e3b90278db0a14df1b7e8ce
      size: 6810
    outs:
    - path: output_models/prod/incremented_model
      hash: md5
      md5: b53072346826210a48b99404aff58646.dir
      size: 440410910
      nfiles: 6
  evaluate_incremental_model:
    cmd: python -m src.evaluating.evaluate_incremental_model --env prod --input-dataset
      output_data/prod/supervised_dataset.parquet --input-new-class output_reports/prod/clustering/new_class.parquet
      --input-true-new-class output_data/prod/supervised_dataset_phase2.parquet --input-model
      output_models/prod/incremented_model --output-reports output_reports/prod/incremental
    deps:
    - path: output_data/prod/supervised_dataset.parquet
      hash: md5
      md5: d9e0799637e035083cd613ff9e8e5ab9
      size: 193359
    - path: output_data/prod/supervised_dataset_phase2.parquet
      hash: md5
      md5: a3a90925a89b78d72d72f7aca17f794b
      size: 59178
    - path: output_models/prod/incremented_model
      hash: md5
      md5: 962562fcf271ed8cc72bef6cf509fa46.dir
      size: 440410910
      nfiles: 6
    - path: output_reports/prod/clustering/new_class.parquet
      hash: md5
      md5: b8f82b9304841f4f58f7f82ed7d07a91
      size: 323088
    - path: src/evaluating/evaluate_incremental_model.py
      hash: md5
      md5: 2cc612caa12dc954f21c3a237f8a4a91
      size: 10514
    outs:
    - path: output_reports/prod/incremental/incremental_classification_report.txt
      hash: md5
      md5: ab4efee89228e158f0007f237da57b69
      size: 518
    - path: output_reports/prod/incremental/incremental_confusion_matrix.png
      hash: md5
      md5: 3991f338ef6364b9ad7258b44c95970e
      size: 19904
    - path: output_reports/prod/incremental/incremental_roc_curve.png
      hash: md5
      md5: 306ad6daa06c5e066bce3bf830b5f343
      size: 53512
